# README: Hello Daemon with Rotary Encoder Interface

## Overview

This project implements an Android native daemon (`HelloImpl`) that interacts with a rotary encoder through GPIO pins. The daemon uses the Android Interface Definition Language (AIDL) to provide methods for retrieving encoder updates and button press states. It is designed to run as a service and handle requests via the AIDL interface.

## Features

1. **Rotary Encoder Interface**: Tracks the rotary encoder's rotation and updates its counter value.
2. **Android Native service**: Runs as a background service using the Android Binder IPC framework.

---

## Project Structure

- **`HelloImpl` Class**: Implements the AIDL interface and interacts with the rotary encoder.
- **Main Entry Point**: Initializes the service and registers it with the Android Binder framework.

---

## Files

### 1. **`HelloImpl.h`**
Defines the `HelloImpl` class, which inherits from `BnHello` (the base class generated by AIDL).

#### Key Methods:

- **`ndk::ScopedAStatus getUpdate(int32_t* _aidl_return)`**
  - Retrieves the current value of the rotary encoder's counter.
  - Returns `STATUS_BAD_VALUE` if the pointer is invalid.
  - Returns `STATUS_UNKNOWN_ERROR` if initialization fails.


### 2. **`HelloImpl.cpp`**
Implements the `HelloImpl` class methods, including rotary encoder initialization and update handling.

#### Key Components:

- **Rotary Encoder Initialization:**
  - Ensures the encoder is initialized only once using a static variable.
  - GPIO pins are hardcoded: `gpioA = 17`, `gpioB = 18`, `gpioSW = 27`.

- **Counter Update:**
  - Continuously updates the encoder's counter until the value stabilizes.
  - Returns the stabilized counter value through `_aidl_return`.


### 3. **Main Function (`main.cpp`)**
Entry point for the daemon, initializes the binder service, and joins the thread pool.

#### Key Functions:

- **`ABinderProcess_setThreadPoolMaxThreadCount(0)`**
  - Sets the binder thread pool to handle incoming AIDL calls.
  
- **`AServiceManager_addService(...)`**
  - Registers the `HelloImpl` instance with the Android service manager.

- **`ABinderProcess_joinThreadPool()`**
  - Joins the binder thread pool, keeping the daemon running.

---

### 4. **Run the service:**


```bash
adb shell
/vendor/bin/hw/hello_service
```

---

## Usage

### AIDL Interface Methods:

1. **`getUpdate()`**
   - Returns the current rotary encoder counter value.
   - Example AIDL call:
     ```java
     hello = IHello.Stub.asInterface(binder);
     int result = hello.getUpdate(); // Get the update
     ```


